<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Blog | E-Shopper</title>
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/font-awesome.min.css" rel="stylesheet" />
    <link href="css/prettyPhoto.css" rel="stylesheet" />
    <link href="css/price-range.css" rel="stylesheet" />
    <link href="css/animate.css" rel="stylesheet" />
    <link href="css/main.css" rel="stylesheet" />
    <link href="css/responsive.css" rel="stylesheet" />
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
    <link rel="shortcut icon" href="images/ico/favicon.ico" />
    <link
      rel="apple-touch-icon-precomposed"
      sizes="144x144"
      href="images/ico/apple-touch-icon-144-precomposed.png"
    />
    <link
      rel="apple-touch-icon-precomposed"
      sizes="114x114"
      href="images/ico/apple-touch-icon-114-precomposed.png"
    />
    <link
      rel="apple-touch-icon-precomposed"
      sizes="72x72"
      href="images/ico/apple-touch-icon-72-precomposed.png"
    />
    <link
      rel="apple-touch-icon-precomposed"
      href="images/ico/apple-touch-icon-57-precomposed.png"
    />
    <style>
      #user-profile {
        position: relative;
        max-width: 600px;
        margin: 20px auto;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        background: #fff;
      }

      .profile-container {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .profile-picture {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .profile-picture img {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #ccc;
      }

      .profile-picture input {
        margin-top: 12px;
      }

      .profile-info {
        flex: 1;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        font-weight: bold;
        display: block;
        margin-bottom: 5px;
      }

      input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }

      .btn-save {
        background: #fe980f;
        color: white;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }

      .btn-save:hover {
        background: #a75e1a;
      }

      #logout-btn {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: rgb(224, 128, 18);
        color: white;
        border: none;
        padding: 10px;
        cursor: pointer;
        font-size: 14px;
        border-radius: 5px;
      }

      #logout-btn:hover {
        background-color: rgb(224, 83, 18);
      }

      .show-btn {
        background-color: rgb(224, 83, 18);
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .show-btn:hover {
        background-color: #b75c10; /* Un color un poco más oscuro */
      }
    </style>
    <style>
      /* Estilo del menú desplegable */
      #submenuExportar {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
        z-index: 1;
        padding: 10px;
        border-radius: 5px;
      }

      #submenuExportar li {
        list-style: none;
      }

      #submenuExportar li a {
        text-decoration: none;
        padding: 8px;
        display: block;
        color: #333;
      }
      #submenuExportar li a:hover {
        background-color: #e64a19;
      }

      #submenuVer {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
        z-index: 1;
        padding: 10px;
        border-radius: 5px;
      }

      #submenuVer li {
        list-style: none;
      }

      #submenuVer li a {
        text-decoration: none;
        padding: 8px;
        display: block;
        color: #333;
      }

      #submenuVer li a:hover {
        background-color: #ddd;
      }
    </style></head
  ><!--/head-->

  <body>
    <header id="header">
      <!--header-->
      <div class="header_top">
        <!--header_top-->
        <div class="container">
          <div class="row">
            <div class="col-sm-6">
              <div class="contactinfo">
                <ul class="nav nav-pills">
                  <li>
                    <a href=""><i class="fa fa-phone"></i> +2 95 01 88 821</a>
                  </li>
                  <li>
                    <a href=""
                      ><i class="fa fa-envelope"></i> info@domain.com</a
                    >
                  </li>
                </ul>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="social-icons pull-right">
                <ul class="nav navbar-nav">
                  <li>
                    <a href=""><i class="fa fa-facebook"></i></a>
                  </li>
                  <li>
                    <a href=""><i class="fa fa-twitter"></i></a>
                  </li>
                  <li>
                    <a href=""><i class="fa fa-linkedin"></i></a>
                  </li>
                  <li>
                    <a href=""><i class="fa fa-dribbble"></i></a>
                  </li>
                  <li>
                    <a href=""><i class="fa fa-google-plus"></i></a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--/header_top-->

      <div class="header-middle">
        <!--header-middle-->
        <div class="container">
          <div class="row">
            <div class="col-sm-4">
              <div class="logo pull-left">
                <a href="index.html"
                  ><img src="images/home/logo.png" alt=""
                /></a>
              </div>
              <div class="btn-group pull-right">
                <div class="btn-group">
                  <button
                    type="button"
                    class="btn btn-default dropdown-toggle usa"
                    data-toggle="dropdown"
                  >
                    USA
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu">
                    <li><a href="">Canada</a></li>
                    <li><a href="">UK</a></li>
                  </ul>
                </div>

                <div class="btn-group">
                  <button
                    type="button"
                    class="btn btn-default dropdown-toggle usa"
                    data-toggle="dropdown"
                  >
                    DOLLAR
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu">
                    <li><a href="">Canadian Dollar</a></li>
                    <li><a href="">Pound</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="col-sm-8">
              <div class="shop-menu pull-right">
                <ul class="nav navbar-nav">
                  <li>
                    <a href="javascript:void(0);" id="accountLink"
                      ><i class="fa fa-user"></i> Account</a
                    >
                  </li>
                  <p
                    id="accountMessage"
                    style="color: red; display: none; margin-left: 10px"
                  ></p>
                  <li class="dropdown">
                    <a
                      href="#"
                      id="verMenu"
                      class="dropdown-toggle"
                      data-toggle="dropdown"
                      ><i class="fa fa-star"></i> Ver <b class="caret"></b
                    ></a>
                    <ul class="dropdown-menu" id="submenuVer">
                      <li><a href="#" id="verPedidos">Pedidos</a></li>
                      <li><a href="#" id="verProductos">Productos</a></li>
                    </ul>
                  </li>
                  <li>
                    <a href="checkout.html"
                      ><i class="fa fa-crosshairs"></i> Checkout</a
                    >
                  </li>
                  <li>
                    <a href="cart.html"
                      ><i class="fa fa-shopping-cart"></i> Cart</a
                    >
                  </li>
                  <li>
                    <a href="login.html"><i class="fa fa-lock"></i> Login</a>
                  </li>
                  <li>
                    <a
                      href="#"
                      id="verMenuExportar"
                      class="dropdown-toggle"
                      data-toggle="dropdown"
                      ><i class="fa fa-file-pdf-o"></i> Exportar
                      <b class="caret"></b
                    ></a>
                    <ul class="dropdown-menu" id="submenuExportar">
                      <li><a href="#" id="exportarPedidos">Pedidos</a></li>
                      <li><a href="#" id="exportarProductos">Productos</a></li>
                    </ul>
                  </li>
                  <li>
                    <a href="javascript:void(0);" id="chartsLink"
                      ><i class="fa fa-bar-chart"></i> Gráficos</a
                    >
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--/header-middle-->

      <div class="header-bottom">
        <!--header-bottom-->
        <div class="container">
          <div class="row">
            <div class="col-sm-9">
              <div class="navbar-header">
                <button
                  type="button"
                  class="navbar-toggle"
                  data-toggle="collapse"
                  data-target=".navbar-collapse"
                >
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
              </div>
              <div class="mainmenu pull-left">
                <ul class="nav navbar-nav collapse navbar-collapse">
                  <li><a href="index.html">Home</a></li>
                  <li class="dropdown">
                    <a href="#">Shop<i class="fa fa-angle-down"></i></a>
                    <ul role="menu" class="sub-menu">
                      <li><a href="shop.html">Products</a></li>
                      <li>
                        <a href="product-details.html">Product Details</a>
                      </li>
                      <li><a href="checkout.html">Checkout</a></li>
                      <li><a href="cart.html">Cart</a></li>
                      <li><a href="login.html">Login</a></li>
                      <li><a href="export.html">Exportar</a></li>
                      <li><a href="charts.html">Gráficos</a></li>
                    </ul>
                  </li>
                  <li class="dropdown">
                    <a href="#" class="active"
                      >Blog<i class="fa fa-angle-down"></i
                    ></a>
                    <ul role="menu" class="sub-menu">
                      <li><a href="blog.html" class="active">Blog List</a></li>
                      <li><a href="blog-single.html">Blog Single</a></li>
                    </ul>
                  </li>
                  <li><a href="404.html">404</a></li>
                  <li><a href="contact-us.html">Contact</a></li>
                </ul>
              </div>
            </div>
            <div class="col-sm-3">
              <!--<div class="search_box pull-right">
                <input type="text" placeholder="Search" />
              </div>-->
              <section id="admin-functions">
                <button id="adminPannelButton" class="show-btn">
                  Admin Panel
                </button>

                <!-- Modal con pestañas -->
                <!-- Modal HTML -->
                <div id="userModal" class="modal" hidden>
                  <div class="modal-content">
                    <div class="tabs">
                      <div class="tab active" id="tab1">Usuarios</div>
                    </div>
                    <div id="userList"></div>
                  </div>
                </div>
              </section>
            </div>
          </div>
        </div>
      </div>
      <!--/header-bottom-->
    </header>
    <!--/header-->

    <section id="user-profile">
      <div class="profile-container">
        <button id="logout-btn">Cerrar sesión</button>
        <div class="profile-picture">
          <img
            id="profile-pic"
            src="https://astrobriga.es/wp-content/plugins/give/assets/dist/images/anonymous-user.svg"
            alt="Foto de perfil"
          />
          <input
            type="file"
            id="upload-pic"
            name="foto_perfil"
            accept="image/*"
          />
        </div>
        <div class="profile-info">
          <form id="profile-form">
            <div class="form-group">
              <label for="username">Nombre de usuario:</label>
              <input type="text" id="username" disabled />
            </div>

            <div class="form-group">
              <label for="contraseña_actual">Contraseña actual:</label>
              <input type="password" id="contraseña_actual" />
            </div>

            <div class="form-group">
              <label for="nueva_contraseña">Nueva contraseña:</label>
              <input type="password" id="nueva_contraseña" />
            </div>

            <button type="submit" class="btn-save">Guardar cambios</button>
          </form>
          <p id="profileMessage"></p>
        </div>
      </div>
    </section>

    <footer id="footer">
      <!--Footer-->
      <div class="footer-top">
        <div class="container">
          <div class="row">
            <div class="col-sm-2">
              <div class="companyinfo">
                <h2><span>e</span>-shopper</h2>
                <p>
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit,sed
                  do eiusmod tempor
                </p>
              </div>
            </div>
            <div class="col-sm-7">
              <div class="col-sm-3">
                <div class="video-gallery text-center">
                  <a href="#">
                    <div class="iframe-img">
                      <img src="images/home/iframe1.png" alt="" />
                    </div>
                    <div class="overlay-icon">
                      <i class="fa fa-play-circle-o"></i>
                    </div>
                  </a>
                  <p>Circle of Hands</p>
                  <h2>24 DEC 2014</h2>
                </div>
              </div>

              <div class="col-sm-3">
                <div class="video-gallery text-center">
                  <a href="#">
                    <div class="iframe-img">
                      <img src="images/home/iframe2.png" alt="" />
                    </div>
                    <div class="overlay-icon">
                      <i class="fa fa-play-circle-o"></i>
                    </div>
                  </a>
                  <p>Circle of Hands</p>
                  <h2>24 DEC 2014</h2>
                </div>
              </div>

              <div class="col-sm-3">
                <div class="video-gallery text-center">
                  <a href="#">
                    <div class="iframe-img">
                      <img src="images/home/iframe3.png" alt="" />
                    </div>
                    <div class="overlay-icon">
                      <i class="fa fa-play-circle-o"></i>
                    </div>
                  </a>
                  <p>Circle of Hands</p>
                  <h2>24 DEC 2014</h2>
                </div>
              </div>

              <div class="col-sm-3">
                <div class="video-gallery text-center">
                  <a href="#">
                    <div class="iframe-img">
                      <img src="images/home/iframe4.png" alt="" />
                    </div>
                    <div class="overlay-icon">
                      <i class="fa fa-play-circle-o"></i>
                    </div>
                  </a>
                  <p>Circle of Hands</p>
                  <h2>24 DEC 2014</h2>
                </div>
              </div>
            </div>
            <div class="col-sm-3">
              <div class="address">
                <img src="images/home/map.png" alt="" />
                <p>505 S Atlantic Ave Virginia Beach, VA(Virginia)</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-widget">
        <div class="container">
          <div class="row">
            <div class="col-sm-2">
              <div class="single-widget">
                <h2>Service</h2>
                <ul class="nav nav-pills nav-stacked">
                  <li><a href="">Online Help</a></li>
                  <li><a href="">Contact Us</a></li>
                  <li><a href="">Order Status</a></li>
                  <li><a href="">Change Location</a></li>
                  <li><a href="">FAQ’s</a></li>
                </ul>
              </div>
            </div>
            <div class="col-sm-2">
              <div class="single-widget">
                <h2>Quock Shop</h2>
                <ul class="nav nav-pills nav-stacked">
                  <li><a href="">T-Shirt</a></li>
                  <li><a href="">Mens</a></li>
                  <li><a href="">Womens</a></li>
                  <li><a href="">Gift Cards</a></li>
                  <li><a href="">Shoes</a></li>
                </ul>
              </div>
            </div>
            <div class="col-sm-2">
              <div class="single-widget">
                <h2>Policies</h2>
                <ul class="nav nav-pills nav-stacked">
                  <li><a href="">Terms of Use</a></li>
                  <li><a href="">Privecy Policy</a></li>
                  <li><a href="">Refund Policy</a></li>
                  <li><a href="">Billing System</a></li>
                  <li><a href="">Ticket System</a></li>
                </ul>
              </div>
            </div>
            <div class="col-sm-2">
              <div class="single-widget">
                <h2>About Shopper</h2>
                <ul class="nav nav-pills nav-stacked">
                  <li><a href="">Company Information</a></li>
                  <li><a href="">Careers</a></li>
                  <li><a href="">Store Location</a></li>
                  <li><a href="">Affillate Program</a></li>
                  <li><a href="">Copyright</a></li>
                </ul>
              </div>
            </div>
            <div class="col-sm-3 col-sm-offset-1">
              <div class="single-widget">
                <h2>About Shopper</h2>
                <form action="#" class="searchform">
                  <input type="text" placeholder="Your email address" />
                  <button type="submit" class="btn btn-default">
                    <i class="fa fa-arrow-circle-o-right"></i>
                  </button>
                  <p>
                    Get the most recent updates from <br />our site and be
                    updated your self...
                  </p>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <div class="container">
          <div class="row">
            <p class="pull-left">
              Copyright © 2013 E-SHOPPER Inc. All rights reserved.
            </p>
            <p class="pull-right">
              Designed by
              <span
                ><a target="_blank" href="http://www.themeum.com"
                  >Themeum</a
                ></span
              >
            </p>
          </div>
        </div>
      </div>
    </footer>
    <!--/Footer-->

    <script src="js/jquery.js"></script>
    <script src="js/price-range.js"></script>
    <script src="js/jquery.scrollUp.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.prettyPhoto.js"></script>
    <script src="js/main.js"></script>

    <script>
      $(document).ready(function () {
        // Cargar datos del usuario
        $.ajax({
          url: "session_check.php",
          type: "GET",
          dataType: "json",
          success: function (response) {
            if (response.logged_in) {
              $("#username").val(response.nombre_usuario);
              $("#profile-pic").attr("src", response.foto_perfil);
              if (response.foto_perfil) {
                $("#profile-pic").attr("src", response.foto_perfil);
              }
              if (response.es_admin) {
                // Si es admin, mostrar el botón de panel admin
                $("#userModal").removeAttr("hidden");
                $("#adminPannelButton").show();
              }
            } else {
              alert("Debes iniciar sesión para ver tu perfil.");
              window.location.href = "login.html";
            }
          },
        });

        // Al hacer clic en el botón de mostrar usuarios
        $("#adminPannelButton").click(function () {
          window.location.href = "admin_panel.html";
        });

        // Cerrar el modal si se hace clic fuera del contenido
        $(document).on("click", function (e) {
          if ($(e.target).is("#userModal")) {
            $("#userModal").fadeOut();
          }
        });

        // Acción al hacer clic en un usuario
        $(document).on("click", ".user-item", function () {
          var username = $(this).data("username");
          alert("Has seleccionado a: " + username);
        });

        // Manejo de subida de imagen
        $("#upload-pic").on("change", function (e) {
          const reader = new FileReader();
          reader.onload = function (event) {
            $("#profile-pic").attr("src", event.target.result);
          };
          reader.readAsDataURL(e.target.files[0]);
        });

        // Guardar cambios
        $("#profile-form").submit(function (e) {
          e.preventDefault();
          let formData = new FormData(this);
          formData.append("foto_perfil", $("#upload-pic")[0].files[0]);
          formData.append("contraseña_actual", $("#contraseña_actual").val());
          formData.append("nueva_contraseña", $("#nueva_contraseña").val());

          $.ajax({
            url: "update_profile.php",
            type: "POST",
            data: formData,
            contentType: false,
            processData: false,
            success: function (response) {
              // Solo se muestra el mensaje contenido en response.message
              $("#profileMessage")
                .text(response.message) // Mostrar solo el mensaje
                .css("color", response.success ? "green" : "red"); // Usar el color dependiendo del éxito
            },
            error: function (xhr) {
              // Solo se muestra el texto del error (si es necesario)
              $("#profileMessage")
                .text("Error al actualizar: " + xhr.responseText) // Mostrar el mensaje de error
                .css("color", "red"); // Poner el color rojo para indicar error
            },
          });
        });
      });
    </script>

    <script>
      document
        .getElementById("logout-btn")
        .addEventListener("click", function () {
          window.location.href = "logout.php";
        });
    </script>
    <script>
      $(document).ready(function () {
        $("#accountLink").on("click", function (e) {
          e.preventDefault();
          $.ajax({
            url: "session_check.php",
            type: "GET",
            dataType: "json",
            success: function (response) {
              if (response.logged_in) {
                if (
                  window.location.pathname.indexOf("personal_page.html") === -1
                ) {
                  window.location.href = "/Eshopper/personal_page.html";
                }
              } else {
                $("#accountMessage")
                  .text("No has iniciado sesión. Redirigiendo...")
                  .show();
                setTimeout(() => {
                  window.location.href = "/Eshopper/login.html";
                }, 2000);
              }
            },
            error: function () {
              alert("Error en el servidor. Inténtalo más tarde.");
            },
          });
        });
      });
    </script>

    <script>
      $(document).ready(function () {
        $("#exportLink").on("click", function (e) {
          e.preventDefault();
          $.ajax({
            url: "session_check.php",
            type: "GET",
            dataType: "json",
            success: function (response) {
              if (response.logged_in) {
                if (window.location.pathname.indexOf("export.html") === -1) {
                  window.location.href = "/Eshopper/export.html";
                }
              } else {
                $("#accountMessage")
                  .text("No has iniciado sesión. Redirigiendo...")
                  .show();
                setTimeout(() => {
                  window.location.href = "/Eshopper/login.html";
                }, 2000);
              }
            },
            error: function () {
              alert("Error en el servidor. Inténtalo más tarde.");
            },
          });
        });
      });
    </script>

    <script>
      $(document).ready(function () {
        $("#chartsLink").on("click", function (e) {
          e.preventDefault();
          $.ajax({
            url: "session_check.php",
            type: "GET",
            dataType: "json",
            success: function (response) {
              if (response.logged_in) {
                if (window.location.pathname.indexOf("charts.html") === -1) {
                  window.location.href = "/Eshopper/charts.html";
                }
              } else {
                $("#accountMessage")
                  .text("No has iniciado sesión. Redirigiendo...")
                  .show();
                setTimeout(() => {
                  window.location.href = "/Eshopper/login.html";
                }, 2000);
              }
            },
            error: function () {
              alert("Error en el servidor. Inténtalo más tarde.");
            },
          });
        });
      });
    </script>
    <script>
      $(document).ready(function () {
        $("#verMenuExportar").click(function () {
          verificarSesion(() => {
            $("#submenuExportar").toggle();
          });
        });

        $("#verMenu").click(function () {
          verificarSesion(() => {
            $("#submenuVer").toggle();
          });
        });

        // Detectar clic fuera
        $(document).click(function (e) {
          if ($("#submenuExportar").is(":visible")) {
            if (
              !$(e.target).closest("#submenuExportar").length &&
              !$(e.target).closest("#verMenuExportar").length
            ) {
              $("#submenuExportar").hide();
            }
          } else if ($("#submenuVer").is(":visible")) {
            if (
              !$(e.target).closest("#submenuVer").length &&
              !$(e.target).closest("#verMenu").length
            ) {
              $("#submenuVer").hide();
            }
          }
        });

        $("#verPedidos").click(function () {
          verificarSesion(() => {
            window.location.href = "ver.html?tipo=pedidos";
          });
        });

        $("#verProductos").click(function () {
          verificarSesion(() => {
            let selectedCategory = getSelectedCategory();
            window.location.href =
              "ver.html?tipo=productos&categoria=" + selectedCategory;
          });
        });
      });

      // Función para verificar si el usuario está logueado
      function verificarSesion(callback) {
        $.ajax({
          url: "session_check.php",
          method: "GET",
          dataType: "json",
          success: function (response) {
            if (response.logged_in) {
              callback(); // Usuario registrado, ejecutar acción
            } else {
              alert("Debes estar registrado para acceder a esta sección.");
            }
          },
          error: function () {
            alert("Error al verificar la sesión del usuario.");
          },
        });
      }

      function getSelectedCategory() {
        return typeof selectedCategory !== "undefined"
          ? selectedCategory
          : "all";
      }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.72/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.72/vfs_fonts.js"></script>
    
    <!--script: PDF productos-->
    <script>
      function toDataURL(url) {
        return new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.onload = function () {
            const reader = new FileReader();
            reader.onloadend = function () {
              resolve(reader.result);
            };
            reader.onerror = reject;
            reader.readAsDataURL(xhr.response);
          };
          xhr.onerror = reject;
          xhr.open("GET", url);
          xhr.responseType = "blob";
          xhr.send();
        });
      }

      async function getHeaderContent() {
        const logoBase64 = await toDataURL("images/home/logo.png").catch(() => null);

        return {
          table: {
            widths: ["*", "*"],
            body: [
              [
                logoBase64
                  ? {
                      image: logoBase64,
                      width: 100,
                      margin: [10, 10, 0, 10],
                    }
                  : { text: "Logo", margin: [10, 10, 0, 10] },
                {
                  alignment: "right",
                  stack: [
                    {
                      text: "+2 95 01 88 821",
                      fontSize: 10,
                      margin: [0, 10, 10, 0],
                    },
                    {
                      text: "info@domain.com",
                      fontSize: 10,
                      margin: [0, 2, 10, 0],
                    },
                    {
                      text:
                        "Facebook | Twitter | LinkedIn | Dribbble | Google+",
                      fontSize: 9,
                      color: "gray",
                      margin: [0, 5, 10, 10],
                    },
                  ],
                },
              ],
            ],
          },
          layout: {
            fillColor: "#d9d6ce",
            hLineWidth: () => 0,
            vLineWidth: () => 0,
            paddingLeft: () => 35,
            paddingRight: () => 35,
            paddingTop: () => 20,
            paddingBottom: () => 25,
          },
          margin: [-40, -40, -40, 20],
        };
      }

      function getFooterDefinition() {
        return function (currentPage, pageCount) {
          return {
            columns: [
              {
                text: "© 2025 E-SHOPPER Inc. Todos los derechos reservados.",
                alignment: "left",
                fontSize: 9,
                margin: [40, 0, 0, 10],
                color: "#FFA500",
              },
              {
                text: `Diseñado por Themeum | Página ${currentPage} de ${pageCount}`,
                alignment: "right",
                fontSize: 9,
                margin: [0, 0, 40, 10],
                color: "#FFA500",
              },
            ],
          };
        };
      }

      async function generarPDFConProductos() {
        console.log("Exportar productos ..");
        try {
          const headerContent = await getHeaderContent();
          const response = await fetch("get_products_by_category.php?category=all");
          const data = await response.json();

          if (!data.success) {
            alert("Error al cargar productos.");
            return;
          }

          const products = data.products;

          const productsWithBase64 = await Promise.all(
            products.map(async (product) => {
              const base64Image = await toDataURL(product.image).catch(() => null);
              return {
                id: product.id,
                name: product.name,
                price: product.price,
                image: base64Image,
              };
            })
          );

          const bodyTable = [
            [
              { text: "ID", bold: true },
              { text: "Imagen", bold: true },
              { text: "Nombre", bold: true },
              { text: "Precio", bold: true },
            ],
          ];

          productsWithBase64.forEach((product) => {
            bodyTable.push([
              { text: product.id.toString() },
              product.image
                ? { image: product.image, width: 50, height: 50 }
                : { text: "No disponible" },
              { text: product.name },
              { text: `$${parseFloat(product.price).toFixed(2)}` },
            ]);
          });

          const docDefinition = {
            content: [
              headerContent,
              {
                text: "Listado de Productos",
                style: "header",
                margin: [0, 0, 0, 20],
              },
              {
                table: {
                  headerRows: 1,
                  widths: [50, 70, "*", 60],
                  body: bodyTable,
                },
              },
            ],
            styles: {
              header: {
                fontSize: 18,
                bold: true,
              },
            },
            footer: getFooterDefinition(),
          };

          pdfMake.createPdf(docDefinition).download("productos.pdf");
        } catch (error) {
          console.error("Error al generar el PDF:", error);
          alert("Ocurrió un error al generar el PDF.");
        }
      }

      document
        .getElementById("exportarProductos")
        .addEventListener("click", generarPDFConProductos);
    </script>


    <!--script: PDF pedidos-->
    <script>
      function toDataURL(url) {
        return new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.onload = function () {
            const reader = new FileReader();
            reader.onloadend = function () {
              resolve(reader.result); // <-- resuelve en base64
            };
            reader.onerror = reject;
            reader.readAsDataURL(xhr.response);
          };
          xhr.onerror = reject;
          xhr.open("GET", url);
          xhr.responseType = "blob";
          xhr.send();
        });
      }
    
      async function generarPDFConPedidos() {
        console.log("Exportar pedidos ..");
        try {
          // 1. Obtener pedidos
          const response = await fetch("get_pedidos.php");
          const data = await response.json();
    
          console.log("Respuesta de get_pedidos.php:", data);
    
          if (!data.success) {
            alert("Error al cargar pedidos.");
            return;
          }
    
          const pedidos = data.pedidos;
    
          // 2. Crear estructura del PDF
          const bodyTable = [
            [
              { text: "ID", bold: true },
              { text: "Título", bold: true },
              { text: "Estado", bold: true },
              { text: "Precio Unidad", bold: true },
              { text: "Total", bold: true },
            ],
          ];
    
          pedidos.forEach((pedido) => {
            bodyTable.push([
              { text: pedido.id.toString() },
              { text: pedido.titulo },
              { text: pedido.estado },
              { text: `$${parseFloat(pedido.precio_unidad).toFixed(2)}` },
              { text: `$${parseFloat(pedido.total).toFixed(2)}` },
            ]);
          });
    
          const logoBase64 = await toDataURL("images/home/logo.png").catch(
            () => null
          );
    
          const docDefinition = {
            content: [
              {
                table: {
                  widths: ["*", "*"],
                  body: [
                    [
                      logoBase64
                        ? {
                            image: logoBase64,
                            width: 100,
                            margin: [10, 10, 0, 10],
                          }
                        : { text: "Logo", margin: [10, 10, 0, 10] },
                      {
                        alignment: "right",
                        stack: [
                          {
                            text: "+2 95 01 88 821",
                            fontSize: 10,
                            margin: [0, 10, 10, 0],
                          },
                          {
                            text: "info@domain.com",
                            fontSize: 10,
                            margin: [0, 2, 10, 0],
                          },
                          {
                            text: "Facebook | Twitter | LinkedIn | Dribbble | Google+",
                            fontSize: 9,
                            color: "gray",
                            margin: [0, 5, 10, 10],
                          },
                        ],
                      },
                    ],
                  ],
                },
                layout: {
                  fillColor: "#d9d6ce",
                  hLineWidth: () => 0,
                  vLineWidth: () => 0,
                  paddingLeft: () => 35,
                  paddingRight: () => 35,
                  paddingTop: () => 20,
                  paddingBottom: () => 25,
                },
                margin: [-40, -40, -40, 20],
              },
              {
                text: "Listado de Pedidos",
                style: "header",
                margin: [0, 0, 0, 20],
              },
              {
                table: {
                  headerRows: 1,
                  widths: [50, "*", "*", "*", "*"],
                  body: bodyTable,
                },
              },
            ],
            styles: {
              header: {
                fontSize: 18,
                bold: true,
              },
            },
            footer: function (currentPage, pageCount) {
              return {
                columns: [
                  {
                    text: "© 2025 E-SHOPPER Inc. Todos los derechos reservados.",
                    alignment: "left",
                    fontSize: 9,
                    margin: [40, 0, 0, 10],
                    color: "#FFA500", // texto naranja
                  },
                  {
                    text: `Diseñado por Themeum | Página ${currentPage} de ${pageCount}`,
                    alignment: "right",
                    fontSize: 9,
                    margin: [0, 0, 40, 10],
                    color: "#FFA500", // texto naranja
                  },
                ],
              };
            },
          };
    
          // 4. Generar PDF
          pdfMake.createPdf(docDefinition).download("pedidos.pdf");
        } catch (error) {
          console.error("Error al generar el PDF:", error);
          alert("Ocurrió un error al generar el PDF.");
        }
      }
    
      document
        .getElementById("exportarPedidos")
        .addEventListener("click", generarPDFConPedidos);
    </script>
  </body>
</html>
